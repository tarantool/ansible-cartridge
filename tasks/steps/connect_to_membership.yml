---

- import_tasks: 'blocks/set_not_expelled_instance.yml'
  when: not not_expelled_instance

- name: 'Connect instance to membership via {{ not_expelled_instance.name }}'
  cartridge_connect_to_membership:
    console_sock: '{{ not_expelled_instance.console_sock }}'
    module_hostvars: '{{ cached_facts.connect_to_membership }}'
    play_hosts: '{{ play_hosts }}'
  register: probe
  until: not probe.failed
  retries: 3
  delay: 5
  run_once: true
  delegate_to: '{{ not_expelled_instance.name }}'
  tags:
    - cartridge-instances
    - cartridge-replicasets
