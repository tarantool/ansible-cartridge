---

- import_tasks: 'blocks/set_non_expelled_instance.yml'
  when: not non_expelled_instance

- name: 'Connect instance to membership'
  cartridge_connect_to_membership:
    console_sock: '{{ not_expelled_instance.console_sock }}'
    hostvars: '{{ hostvars }}'
    play_hosts: '{{ play_hosts }}'
  register: probe
  until: not probe.failed
  retries: 3
  delay: 5
  run_once: true
  delegate_to: '{{ not_expelled_instance.name }}'
  tags:
    - cartridge-instances
    - cartridge-replicasets
